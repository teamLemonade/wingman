<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Wingman</title>

    <!-- Wingman Platform styles -->
    <link rel="stylesheet" href="../app/css/lemonade.css" type="text/css" />
    <link rel="stylesheet" href="../app/css/treeview.css" type="text/css" />

    <!-- TreeViewPlugin -->


    <style>
        html,
        body {
            height: 100%;
            background: #f2f2f2;
        }

        body {
            font-family: 'Roboto', sans-serif;
            font-size: 14px;
            line-height: 1.50;
            -webkit-font-smoothing: antialiased;
            margin: 0;
            overflow: hidden;
        }

        .column {
            float: left;
            width: 100%;
        }

        .row:after {
            content: "";
            display: table;
            clear: both;
        }

        canvas {
            width: 80%;
            flex-shrink: 1;
            float: left;
        }
    </style>

</head>

<body onload="document.initAachen()">

    <script type="module">


        //------------------------------------------------------------------------------------------------------------------------------------------
        // Request for geo data and sensorValue
        //------------------------------------------------------------------------------------------------------------------------------------------


        var geoData = new XMLHttpRequest();
        geoData.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                var weather = JSON.parse(this.responseText);
                document.getElementById("location").innerHTML =
                    "Location: " + weather.coord.lat.toFixed(2) + ", " + weather.coord.lon.toFixed(2) + ", " + weather.name + ", " + weather.sys.country;
                document.getElementById("weather").innerHTML =
                    "Weather: " + weather.weather[0].main + ", " + (weather.main.feels_like - 273.15).toFixed(2) + "°C ";
            }
        };

        function getGeo(url) {
            geoData.open("GET", url, true);
            geoData.send();
        }

        //------------------------------------------------------------------------------------------------------------------------------------------
        //create viewer
        //------------------------------------------------------------------------------------------------------------------------------------------


        import { Viewer } from "../src/viewer/Viewer.js";
        import { XKTLoaderPlugin } from "../src/plugins/XKTLoaderPlugin/XKTLoaderPlugin.js";

        //import menu
        import { ContextMenu } from "../src/extras/ContextMenu/ContextMenu.js";
        import { TreeViewPlugin } from "../src/plugins/TreeViewPlugin/TreeViewPlugin.js";

        //import nav cube
        import { NavCubePlugin } from "../src/plugins/NavCubePlugin/NavCubePlugin.js";

        //import mesh 
        import { Mesh } from "../src/viewer/scene/mesh/Mesh.js";
        import { VBOGeometry } from "../src/viewer/scene/geometry/VBOGeometry.js";
        import { buildGridGeometry } from "../src/viewer/scene/geometry/builders/buildGridGeometry.js";
        import { PhongMaterial } from "../src/viewer/scene/materials/PhongMaterial.js";

        const viewer = new Viewer({
            canvasId: "myCanvas"
        });

        viewer.camera.eye = [25, 150, 75];
        viewer.camera.look = [0, 5, 0];
        viewer.camera.up = [-0.01, 0.99, 0.039];


        viewer.cameraControl.doublePickFlyTo = true;
        viewer.cameraControl.panRightClick = true;
        viewer.cameraControl.followPointer = true;

        viewer.cameraControl.touchDollyRate = 1;
        viewer.cameraControl.mouseWheelDollyRate = 60;
        viewer.cameraControl.keyboardDollyRate = 20;
        viewer.cameraControl.rotationInertia = 0;
        viewer.cameraControl.dollyInertia = 0;


        //------------------------------------------------------------------------------------------------------------------
        // declare the sensor data query function
        //------------------------------------------------------------------------------------------------------------------


        var sensor = new XMLHttpRequest();
        var globalRefresh;

        function loadXMLDoc(url, cfunc) {
            sensor.onreadystatechange = cfunc;
            sensor.open("GET", url, true);
            sensor.send();
        }

        function loadSensor(param, name) {
            var localRefresh = setInterval(function () {
                loadXMLDoc("https://webhooks.mongodb-realm.com/api/client/v2.0/app/sensordata-rzgof/service/sensorValue/incoming_webhook/sensorValue", function () {
                    if (sensor.readyState == 4 && sensor.status == 200) {
                        var data = JSON.parse(sensor.responseText);
                        document.getElementById("info1").style.borderLeft = "#03103f solid 0.25em";
                        document.getElementById("info1").style.margin = "1em 0.25em 0";
                        document.getElementById("info1").style.paddingLeft = "0.5em";

                        document.getElementById("info1").innerHTML = "<b>Name: </b>" + name;
                        document.getElementById("info2").innerHTML = "<b>Temperatures: </b>" + data[param].temperatures.$numberDouble + "°C";
                        document.getElementById("info3").innerHTML = "<b>Moisture: </b>" + data[param].moisture.$numberDouble + "%";
                        document.getElementById("info4").innerHTML = "<b>Windspeed: </b>" + data[param].windspeed.$numberDouble + "m/s";
                        document.getElementById("info5").innerHTML = "<b>Winddirection: </b>" + data[param].winddirection.$numberDouble + "°";
                        document.getElementById("info6").innerHTML = "<b>Ozone: </b>" + data[param].ozone.$numberDouble + "µg/m³";
                        document.getElementById("info7").innerHTML = "<b>Noise level: </b>" + data[param].NoiseLevel.$numberDouble + "dB";
                        document.getElementById("info8").innerHTML = "<b>Last update at: </b>" + data[param].timestamp + " (CET)";
                    }
                })
            }, 5000);

            globalRefresh = localRefresh;
        }

        function stopRefresh() {
            clearInterval(globalRefresh);
        }


        //------------------------------------------------------------------------------------------------------------------
        // set up the clock
        //------------------------------------------------------------------------------------------------------------------

        var timerInterval = setInterval(function () { timer() }, 1000);

        function timer() {
            var d = new Date();
            d.setHours(d.getHours() - 7);
            var hours = d.toLocaleTimeString();
            var day = d.toDateString();
            document.getElementById("time").innerHTML = hours + ", " + day + " (CET)";
        }


        //------------------------------------------------------------------------------------------------------------------
        // set up the property query function
        //------------------------------------------------------------------------------------------------------------------

        function clearProperty() {
            document.getElementById("info1").style.border = "0px"
            document.getElementById("info1").style.paddingLeft = "0"
            document.getElementById("info1").style.marginLeft = "0"

            document.getElementById("info1").innerHTML = '<i>Click on objects for more info</i>';
            document.getElementById("info2").innerHTML = "";
            document.getElementById("info3").innerHTML = "";
            document.getElementById("info4").innerHTML = "";
            document.getElementById("info5").innerHTML = "";
            document.getElementById("info6").innerHTML = "";
            document.getElementById("info7").innerHTML = "";
            document.getElementById("info8").innerHTML = "";
            document.getElementById("info9").innerHTML = "";
        }

        function getProperty(param) { //edit metascene.js metaobject.js and metamodel.js
            document.getElementById("info1").style.borderLeft = "#03103f solid 0.25em";
            document.getElementById("info1").style.margin = "1em 0.25em 0";
            document.getElementById("info1").style.paddingLeft = "0.5em";

            document.getElementById("info1").innerHTML = "<b>Address: </b>" + param.address;

            if (param.title !== undefined) {
                document.getElementById("info2").innerHTML = "<b>Name: </b>" + param.title;
            } else {
                document.getElementById("info2").innerHTML = "<b>Name: </b>" + param.name;
            }

            document.getElementById("info3").innerHTML = "<b>Type: </b>" + param.type;
            document.getElementById("info4").innerHTML = "<b>Date of built: </b>" + param.date;
            document.getElementById("info5").innerHTML = "<b>Historic: </b>" + param.historic;
            document.getElementById("info6").innerHTML = "<b>Base area: </b>" + param.area;
            document.getElementById("info7").innerHTML = "<b>Owner of the premises: </b>" + param.owner;
            document.getElementById("info8").innerHTML = "";

        }
        //------------------------------------------------------------------------------------------------------------------
        // Load models
        //------------------------------------------------------------------------------------------------------------------


        const xktLoader = new XKTLoaderPlugin(viewer);

        var globalModel = [];

        function clearCanvas() {
            globalModel.forEach(element => element.destroy());
            globalModel.length = 0;
            stopRefresh();
            lastEntity = null;
            clearProperty();
        }

        document.initAachen = function () {

            if (globalModel !== "undefined") { clearCanvas() }

            globalModel.push(xktLoader.load({
                id: "Building",
                src: "../app/data/projects/Aachen/models/Building/building.xkt",
                metaModelSrc: "../app/data/projects/Aachen/models/Building/building.json",
                edges: true
            }));

            globalModel.push(xktLoader.load({
                id: "Pipes",
                src: "../app/data/projects/Aachen/models/Pipes/pipes.xkt",
                metaModelSrc: "../app/data/projects/Aachen/models/Pipes/pipes.json",
                edges: true,
            }));

            globalModel.push(xktLoader.load({
                id: "Terrain_and_traffic",
                src: "../app/data/projects/Aachen/models/terrain/terrain.xkt",
                metaModelSrc: "../app/data/projects/Aachen/models/terrain/terrain.json",
                edges: true,
            }));

            //load geo
            getGeo("https://api.openweathermap.org/data/2.5/weather?id=3247449&appid=164d9c87e52c6093c36d1dc348e167d8");

        }

        document.initWaterlock = function () {

            clearCanvas();

            globalModel.push(xktLoader.load({
                id: "Duplex",
                src: "../app/data/projects/WaterLock/models/design/geometry.xkt",
                metaModelSrc: "../app/data/projects/WaterLock/models/design/metadata.json",
                edges: true
            }));

            //load geo
            getGeo("https://api.openweathermap.org/data/2.5/weather?id=2759661&appid=164d9c87e52c6093c36d1dc348e167d8");

        }

        document.initSchependomlaan = function () {

            clearCanvas();

            globalModel.push(xktLoader.load({
                id: "Schependomlaan",
                src: "../app/data/projects/Schependomlaan/models/design/geometry.xkt",
                metaModelSrc: "../app/data/projects/Schependomlaan/models/design/metadata.json",
                edges: true
            }));

            //load geo
            getGeo("https://api.openweathermap.org/data/2.5/weather?id=2750053&appid=164d9c87e52c6093c36d1dc348e167d8");

        }

        document.initHospital = function () {

            clearCanvas();

            globalModel.push(xktLoader.load({
                id: "WestRiversideHospital",
                src: "../app/data/projects/WestRiversideHospital/models/architectural/geometry.xkt",
                metaModelSrc: "../app/data/projects/WestRiversideHospital/models/architectural/metadata.json",
                edges: true
            }));

            globalModel.push(xktLoader.load({
                id: "WestRiversideHospital",
                src: "../app/data/projects/WestRiversideHospital/models/electrical/geometry.xkt",
                metaModelSrc: "../app/data/projects/WestRiversideHospital/models/electrical/metadata.json",
                edges: true
            }));

            globalModel.push(xktLoader.load({
                id: "WestRiversideHospital",
                src: "../app/data/projects/WestRiversideHospital/models/fireAlarms/geometry.xkt",
                metaModelSrc: "../app/data/projects/WestRiversideHospital/models/fireAlarms/metadata.json",
                edges: true
            }));

            globalModel.push(xktLoader.load({
                id: "WestRiversideHospital",
                src: "../app/data/projects/WestRiversideHospital/models/mechanical/geometry.xkt",
                metaModelSrc: "../app/data/projects/WestRiversideHospital/models/mechanical/metadata.json",
                edges: true
            }));

            globalModel.push(xktLoader.load({
                id: "WestRiversideHospital",
                src: "../app/data/projects/WestRiversideHospital/models/plumbing/geometry.xkt",
                metaModelSrc: "../app/data/projects/WestRiversideHospital/models/plumbing/metadata.json",
                edges: true
            }));

            globalModel.push(xktLoader.load({
                id: "WestRiversideHospital",
                src: "../app/data/projects/WestRiversideHospital/models/sprinklers/geometry.xkt",
                metaModelSrc: "../app/data/projects/WestRiversideHospital/models/sprinklers/metadata.json",
                edges: true
            }));


            globalModel.push(xktLoader.load({
                id: "WestRiversideHospital",
                src: "../app/data/projects/WestRiversideHospital/models/structure/geometry.xkt",
                metaModelSrc: "../app/data/projects/WestRiversideHospital/models/structure/metadata.json",
                edges: true
            }));

            //load geo
            getGeo("https://api.openweathermap.org/data/2.5/weather?id=5368361&appid=164d9c87e52c6093c36d1dc348e167d8");

        }


        //----------------------------------------------------------------------------------------------------------------------
        // Create a tree view
        //----------------------------------------------------------------------------------------------------------------------

        const treeView = new TreeViewPlugin(viewer, {
            containerElement: document.getElementById("treeViewContainer"),
            autoExpandDepth: 0,
            hierarchy: "containment"
        });

        const treeViewContextMenu = new ContextMenu({

            items: [
                [
                    {
                        title: "View Fit",
                        doAction: function (context) {
                            const scene = context.viewer.scene;
                            const objectIds = [];
                            context.treeViewPlugin.withNodeTree(context.treeViewNode, (treeViewNode) => {
                                if (treeViewNode.objectId) {
                                    objectIds.push(treeViewNode.objectId);
                                }
                            });
                            scene.setObjectsVisible(objectIds, true);
                            scene.setObjectsHighlighted(objectIds, true);
                            context.viewer.cameraFlight.flyTo({
                                projection: "perspective",
                                aabb: scene.getAABB(objectIds),
                                duration: 0.5
                            }, () => {
                                setTimeout(function () {
                                    scene.setObjectsHighlighted(scene.highlightedObjectIds, false);
                                }, 500);
                            });
                        }
                    },
                    {
                        title: "View Fit All",
                        doAction: function (context) {
                            const scene = context.viewer.scene;
                            context.viewer.cameraFlight.flyTo({
                                projection: "perspective",
                                aabb: scene.getAABB({}),
                                duration: 0.5
                            });
                        }
                    }
                ],
                [
                    {
                        title: "X-Ray Others",
                        doAction: function (context) {
                            if (lastEntity !== null) {
                                lastEntity.colorize = lastColorize;
                                lastEntity = null;
                                lastColorize = null;
                                stopRefresh();
                            }


                            var entity = context.treeViewNode;
                            const viewer = context.viewer;
                            const scene = viewer.scene;
                            const metaObject = viewer.metaScene.metaObjects[entity.objectId];

                            if (metaObject.id == "3rFeaDCe58Ph8ptbjJL$5m") { loadSensor(40, metaObject.name) }
                            else if (metaObject.id == "3rFeaDCe58Ph8ptbjJL$vK") { loadSensor(41, metaObject.name) }
                            else if (metaObject.id == "3rFeaDCe58Ph8ptbjJL$vQ") { loadSensor(42, metaObject.name) }
                            else if (metaObject.id == "3rFeaDCe58Ph8ptbjJL$v1") { loadSensor(43, metaObject.name) }
                            else if (metaObject.id == "3rFeaDCe58Ph8ptbjJL$vo") { loadSensor(44, metaObject.name) }
                            else { getProperty(metaObject) }


                            scene.setObjectsVisible(scene.objectIds, true);
                            scene.setObjectsXRayed(scene.objectIds, true);
                            scene.setObjectsSelected(scene.selectedObjectIds, false);
                            scene.setObjectsHighlighted(scene.highlightedObjectIds, false);
                            context.treeViewPlugin.withNodeTree(context.treeViewNode, (treeViewNode) => {
                                if (treeViewNode.objectId) {
                                    const entity = scene.objects[treeViewNode.objectId];
                                    if (entity) {
                                        entity.xrayed = false;
                                    }
                                }
                            });
                        }
                    },
                    {
                        title: "Reset X-Ray",
                        getEnabled: function (context) {
                            return (context.viewer.scene.numXRayedObjects > 0);
                        },
                        doAction: function (context) {
                            context.viewer.scene.setObjectsXRayed(context.viewer.scene.xrayedObjectIds, false);
                            clearProperty();
                        }
                    }
                ]
            ]
        });

        // Right-clicking on a tree node shows the context menu for that node

        treeView.on("contextmenu", (e) => {

            treeViewContextMenu.context = { // Must set context before opening menu
                viewer: e.viewer,
                treeViewPlugin: e.treeViewPlugin,
                treeViewNode: e.treeViewNode,
                entity: e.viewer.scene.objects[e.treeViewNode.objectId] // Only defined if tree node is a leaf node
            };

            treeViewContextMenu.show(e.event.pageX, e.event.pageY);
        });

        // Left-clicking on a tree node isolates that object in the 3D view

        treeView.on("nodeTitleClicked", (e) => {
            const scene = viewer.scene;
            const objectIds = [];

            e.treeViewPlugin.withNodeTree(e.treeViewNode, (treeViewNode) => {
                if (treeViewNode.objectId) {
                    objectIds.push(treeViewNode.objectId);
                }

            });
            e.treeViewPlugin.unShowNode();

            scene.setObjectsXRayed(scene.objectIds, true);
            scene.setObjectsVisible(scene.objectIds, true);
            scene.setObjectsXRayed(objectIds, false);
            viewer.cameraFlight.flyTo({
                aabb: scene.getAABB(objectIds),
                duration: 0.5
            }, () => {
                setTimeout(function () {
                    scene.setObjectsVisible(scene.xrayedObjectIds, true);
                    scene.setObjectsXRayed(scene.xrayedObjectIds, true);
                }, 500);
            });

            if (lastEntity !== null) {
                lastEntity.colorize = lastColorize;
            }
            stopRefresh();
            lastEntity = null;
            lastColorize = null;

            const metaObject = e.viewer.metaScene.metaObjects[objectIds[0]];

            if (metaObject.id == "3rFeaDCe58Ph8ptbjJL$5m") { loadSensor(40, metaObject.name) }
            else if (metaObject.id == "3rFeaDCe58Ph8ptbjJL$vK") { loadSensor(41, metaObject.name) }
            else if (metaObject.id == "3rFeaDCe58Ph8ptbjJL$vQ") { loadSensor(42, metaObject.name) }
            else if (metaObject.id == "3rFeaDCe58Ph8ptbjJL$v1") { loadSensor(43, metaObject.name) }
            else if (metaObject.id == "3rFeaDCe58Ph8ptbjJL$vo") { loadSensor(44, metaObject.name) }
            else { getProperty(metaObject) }


        });

        
        //------------------------------------------------------------------------------------------------------------------
        // Create two ContextMenus - one for right-click on empty space, the other for right-click on an Entity
        //------------------------------------------------------------------------------------------------------------------


        const canvasContextMenu = new ContextMenu({
            enabled: true,
            context: {
                viewer: viewer
            },
            items: [
                [
                    {
                        title: "Hide All",
                        getEnabled: function (context) {
                            return (context.viewer.scene.numVisibleObjects > 0);
                        },
                        doAction: function (context) {
                            context.viewer.scene.setObjectsVisible(context.viewer.scene.visibleObjectIds, false);
                        }
                    },
                    {
                        title: "Show All",
                        getEnabled: function (context) {
                            const scene = context.viewer.scene;
                            return (scene.numVisibleObjects < scene.numObjects);
                        },
                        doAction: function (context) {
                            const scene = context.viewer.scene;
                            scene.setObjectsVisible(scene.objectIds, true);
                            scene.setObjectsXRayed(scene.xrayedObjectIds, false);
                            scene.setObjectsSelected(scene.selectedObjectIds, false);
                        }
                    }
                ],
                [
                    {
                        title: "View Fit All",
                        doAction: function (context) {
                            context.viewer.cameraFlight.flyTo({
                                aabb: context.viewer.scene.getAABB()
                            });
                        }
                    }
                ]
            ]
        });

        const objectContextMenu = new ContextMenu({
            items: [
                [
                    {
                        title: "View Fit",
                        doAction: function (context) {
                            const viewer = context.viewer;
                            const scene = viewer.scene;
                            const entity = context.entity;
                            viewer.cameraFlight.flyTo({
                                aabb: entity.aabb,
                                duration: 0.5
                            }, () => {
                                setTimeout(function () {
                                    scene.setObjectsHighlighted(scene.highlightedObjectIds, false);
                                }, 500);
                            });
                        }
                    },
                    {
                        title: "View Fit All",
                        doAction: function (context) {
                            const scene = context.viewer.scene;
                            context.viewer.cameraFlight.flyTo({
                                projection: "perspective",
                                aabb: scene.getAABB(),
                                duration: 0.5
                            });
                        }
                    },
                    {
                        title: "Show in Tree",
                        doAction: function (context) {
                            const objectId = context.entity.id;
                            context.treeViewPlugin.showNode(objectId);
                        }
                    }
                ],
                [
                    {
                        title: "X-Ray Others",
                        doAction: function (context) {
                            if (lastEntity !== null) {
                                lastEntity.colorize = lastColorize;
                                lastEntity = null;
                                lastColorize = null;
                                stopRefresh();
                            }

                            const viewer = context.viewer;
                            const scene = viewer.scene;
                            const entity = context.entity;
                            const metaObject = viewer.metaScene.metaObjects[entity.id];

                            if (entity.id == "3rFeaDCe58Ph8ptbjJL$5m") { loadSensor(40, metaObject.name) }
                            else if (entity.id == "3rFeaDCe58Ph8ptbjJL$vK") { loadSensor(41, metaObject.name) }
                            else if (entity.id == "3rFeaDCe58Ph8ptbjJL$vQ") { loadSensor(42, metaObject.name) }
                            else if (entity.id == "3rFeaDCe58Ph8ptbjJL$v1") { loadSensor(43, metaObject.name) }
                            else if (entity.id == "3rFeaDCe58Ph8ptbjJL$vo") { loadSensor(44, metaObject.name) }
                            else { getProperty(metaObject) }

                            if (!metaObject) {
                                return;
                            }
                            scene.setObjectsVisible(scene.objectIds, true);
                            scene.setObjectsXRayed(scene.objectIds, true);
                            scene.setObjectsSelected(scene.selectedObjectIds, false);
                            scene.setObjectsHighlighted(scene.highlightedObjectIds, false);
                            metaObject.withMetaObjectsInSubtree((metaObject) => {
                                const entity = scene.objects[metaObject.id];
                                if (entity) {
                                    entity.xrayed = false;
                                }
                            });
                        }
                    },
                    {
                        title: "Reset X-Ray",
                        getEnabled: function (context) {
                            return (context.viewer.scene.numXRayedObjects > 0);
                        },
                        doAction: function (context) {
                            context.viewer.scene.setObjectsXRayed(context.viewer.scene.xrayedObjectIds, false);
                            clearProperty();
                        }
                    }
                ]
            ],
            enabled: true
        });

        viewer.cameraControl.on("rightClick", function (e) {

            var hit = viewer.scene.pick({
                canvasPos: e.canvasPos
            });

            if (hit && hit.entity.isObject) {

                objectContextMenu.context = { // Must set context before showing menu
                    viewer: viewer,
                    treeViewPlugin: treeView,
                    entity: hit.entity
                };

                objectContextMenu.show(e.event.pageX, e.event.pageY);

            } else {

                canvasContextMenu.context = { // Must set context before showing menu
                    viewer: viewer
                };

                canvasContextMenu.show(e.event.pageX, e.event.pageY);
            }

            e.event.preventDefault();
        });


        //------------------------------------------------------------------------------------------------------------------
        // Click entity to get info and highlight it
        //------------------------------------------------------------------------------------------------------------------


        var lastEntity = null;
        var lastColorize = null;

        viewer.cameraControl.on("picked", (pickResult) => {
            const entity = pickResult.entity;
            const metaObject = viewer.metaScene.metaObjects[entity.id];
            stopRefresh();

            if (entity.id == "3rFeaDCe58Ph8ptbjJL$5m") { loadSensor(40, metaObject.name) }
            else if (entity.id == "3rFeaDCe58Ph8ptbjJL$vK") { loadSensor(41, metaObject.name) }
            else if (entity.id == "3rFeaDCe58Ph8ptbjJL$vQ") { loadSensor(42, metaObject.name) }
            else if (entity.id == "3rFeaDCe58Ph8ptbjJL$v1") { loadSensor(43, metaObject.name) }
            else if (entity.id == "3rFeaDCe58Ph8ptbjJL$vo") { loadSensor(44, metaObject.name) }
            else { getProperty(metaObject) }


            if (!lastEntity || entity.id !== lastEntity.id) {
                if (lastEntity) {
                    lastEntity.colorize = lastColorize;
                    viewer.scene.setObjectsXRayed(viewer.scene.xrayedObjectIds, false);
                }
                lastEntity = pickResult.entity;
                lastColorize = pickResult.entity.colorize.slice();
                pickResult.entity.colorize = [1, 130 / 255, 0];
                viewer.scene.setObjectsXRayed(viewer.scene.xrayedObjectIds, false);


            } else if (entity.id == lastEntity.id || globalModel.length == 0) {
                stopRefresh();
                lastEntity = null;
                pickResult.entity.colorize = lastColorize;
                clearProperty();
                viewer.scene.setObjectsXRayed(viewer.scene.xrayedObjectIds, false);

            }
        });


        //------------------------------------------------------------------------------------------------------------------
        // Create a mesh with grid
        //------------------------------------------------------------------------------------------------------------------


        new Mesh(viewer.scene, {
            geometry: new VBOGeometry(viewer.scene, buildGridGeometry({
                size: 1500,
                divisions: 150
            })),
            material: new PhongMaterial(viewer.scene, {
                color: [0.0, 0.0, 0.0],
                emissive: [0.4, 0.4, 0.4]
            }),
            position: [0, -5, 0],
            collidable: false
        });


        //------------------------------------------------------------------------------------------------------------------
        // Create a Navigation Cube
        //------------------------------------------------------------------------------------------------------------------


        new NavCubePlugin(viewer, {
            canvasId: "myNavCubeCanvas",
            visible: true,           // Initially visible (default)
            size: 200,               // NavCube size in pixels (default is 200)
            alignment: "topLeft",   // Align NavCube to top-left of Viewer canvas
            topMargin: 50,          // 170 pixels margin from top of Viewer canvas
            cameraFly: true,       // Fly camera to each selected axis/diagonal
            cameraFitFOV: 45,        // How much field-of-view the scene takes once camera has fitted it to view
            cameraFlyDuration: 0.5, // How long (in seconds) camera takes to fly to each new axis/diagonal
            color: "#FFFFFF",
            synchProjection: true
        });


    </script>



    <div class="container">
        <div class="headcontainer">

            <div class="header">

                <!-- Title -->
                <div class="header title">
                    <h1>Wingman - Construction Project Info Platform</h1>
                    <i>Alpha Testing | v0.9.2</i>
                </div>

                <div class="nav">

                    <!-- Project selector/Drop down list -->
                    <div class="nav project">
                        <br />
                        <p>Project: <select>
                                <option value="Aachen" onclick="document.initAachen()" selected>Aachen</option>
                                <option value="Waterlock" onclick="document.initWaterlock()">Waterlock</option>
                                <option value="Schependomlaan" onclick="document.initSchependomlaan()">
                                    Schependomlaan
                                </option>
                                <option value="West riverside hospital" onclick="document.initHospital()">
                                    West riverside hospital</option>
                            </select></p>
                    </div>

                    <!-- Phase selector -->
                    <div class="nav phase">

                        Phase: &nbsp;
                        <button type="button">Early-term</button>
                        <button type="button">Mid-term</button>
                        <button type="button">End-term</button>

                    </div>

                </div>

            </div>

            <!-- Geo info -->
            <div class="geo">

                <p id="location">Loading geo data...</p>
                <p id="weather"></p>
                <p id="time"></p>

            </div>

            <div class="news">
                <marquee><i>Welcome to <b>Wingman</b></i></marquee>
            </div>

        </div>




        <!--middle-->
        <div class="midcontainer">

            <div class="layer">
                <h2>Info Layer</h2>

                <div id="treeViewContainer">


                </div>
            </div>

            <canvas id="myCanvas"></canvas>

            <canvas id="myNavCubeCanvas"></canvas>

            <div class="info">
                <h2>Information</h2>
                <ul>
                    <li id="info1"></li>
                    <li id="info2"></li>
                    <li id="info3"></li>
                    <li id="info4"></li>
                    <li id="info5"></li>
                    <li id="info6"></li>
                    <li id="info7"></li>
                    <li id="info8"></li>
                    <li id="info9"></li>

                </ul>
            </div>
        </div>


        <!--buttom-->
        <div class="buttomcontainer">
            <i>Copyright</i>
            <img src="..\images\Lemonade_Logo_4_transparent_white.png" width="8%" alt="Team Lemonade">
            <img src="..\images\xeolabs_transparent.png" width="2%" alt="Xeolabs">
            <img src="..\images\dc_logo.svg" width="9%" alt="Lehrstuhl DC">
            <img src="..\images\IP_logo_transparent.png" width="10%" alt="Lehrstuhl IP">
            <img src="..\images\itnrw_logo.png" width="8%" alt="IT NRW">



        </div>
    </div>


</body>



</html>